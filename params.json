{"name":"HaythServ","tagline":"HaythServ — Cube 2: Sauerbraten server modification.","body":"# HaythServ\r\nCube 2: Sauerbraten server modification based on SuckerServ\r\n\r\n## Features:\r\n* Based on SuckerServ-v5.\r\n* Many bugs fixed.\r\n* Login and register system.\r\n  * #master, #admin, #root commands to claim privileges after verifying with your account.\r\n* Root privilege level.\r\n* Improved man system¹.\r\n* Unix-like command syntax².\r\n* Many root commands to administrate the server.\r\n* #mkt command to set the duration of a kick done by a master (in seconds).\r\n* #getip command to easily get a player's IP-Address.\r\n\r\n***\r\n\r\n## To do list:\r\n\r\n* Improve name protection.\r\n* Add #setaccountpriv command (#sap) to change an account's privilege level.\r\n* Add best-flagrun support.\r\n* Support to load, unload and reload modules on-the-fly.\r\n* Fix auth-system.\r\n* Improve cheater-detection.\r\n\r\n***\r\n\r\n## Known bugs:\r\n\r\n* Name protection allows login as other account...(lol).\r\n* Cheater-detection may ban non-cheaters³.\r\n* Auth-system not working.\r\n\r\n***\r\n\r\n# Wiki\r\n\r\n***\r\n\r\n## Installing\r\n\r\n***\r\n\r\nFirst we need to clone the latest version, do:\r\n\r\n```bash\r\ngit clone https://github.com/Gnaoprr/HaythServ.git ./HaythServ/\r\n```\r\n\r\nand it will automatically clone it. Now we need to give execute permission to the install script, then it will do everything automatically (on some distros, it will have problems with libboost-all, cause of other versions)\r\n\r\n```bash\r\ncd ./HaythServ/\r\nchmod +x ./install.sh\r\n./install.sh\r\n```\r\n\r\nwill install it. If you discover problems with libboost-all, and you use a debian based distro, do this:\r\n\r\n```bash\r\napt-cache search libboost | awk '{ print $1 }' | xargs apt-get install build-essential cmake gcc libgeoip-dev libzip-dev make subversion sqlite3 libmysql++ apache2 php5-mysql libapache2-mod-php5 liblua5.1-socket mysql-server libssl-dev postgresql sqlite3\r\n```\r\n\r\nit will do the job.\r\n\r\n***\r\n\r\n## Configuring\r\n\r\nThe configuration files are all stored in the ./conf/ directory - that's all you need to edit to configure the server. The server config is the server.conf file in the ./conf/ directory - it should look like this:\r\n\r\n```lua\r\n###############################################################################\r\n# Cube 2: Sauerbraten Game Server Configuration #\r\n# Based on SuckerServ (which is based on Hopmod) #\r\n# #\r\n# Visit http://piernov.org/dokuwiki/en:haythserv:start for a full list of #\r\n# configuration variables. #\r\n# #\r\n###############################################################################\r\n\r\n# A server name for players to identify your server.\r\nservername \"^f3Running ^f5HaythServ\"\r\n\r\n###############################################################################\r\n# Default connection information:\r\n# Game Server socket binds to UDP 0.0.0.0:28785\r\n# Game Server Info socket binds to UDP 0.0.0.0:<serverport+1> (28786)\r\n###############################################################################\r\n\r\n# Server's IP address\r\n# serverip \"0.0.0.0\"\r\n\r\n# Game server port.\r\nserverport 28785\r\n\r\n# Register your server with the master server every 1 hour to appear on the public server list.\r\npublicserver 1\r\n\r\n# Set the maximum number of client connections allowed\r\nmaxclients 128\r\n\r\n# +1 slot each spectator\r\nspecslots 0\r\n\r\n# Number of reserved connection slots for admin players\r\n# Admin use: /connect <serverip> [<serverport>] <admin_password>\r\n# Connecting admin players will have invisible admin status.\r\nreserved_slots 5\r\nreserved_slots_password \"\" # Allow reserved slot usage without giving them admin privilege\r\n\r\n# Message of the day. This message is sent on player connection.\r\nmotd (concat (red \"Running\") (magenta \"HaythServ\"))\r\n\r\n# Password to claim root.\r\nroot_password \"crackme\"\r\n\r\n# The admin password. Same password used by all admin players to gain admin privilege, by typing /setmaster <admin_password>\r\nadmin_password \"wasd\"\r\n\r\n# The master password. Same password used by all master players to gain master privilege, by typing /setmaster <master_password>. Only useful if allow_setmaster is 0\r\nmaster_password \"dsaw\"\r\n\r\n# Uncomment and set a server password to lock the game server and require connecting players to send the server password to get access.\r\n# Note: The Cube 2 client doesn't provide a password dialog GUI: players must use the command line to connect to a server with a given password.\r\n#server_password \"\"\r\n\r\n# Time in ms to wait at intermession before changing map — affect also mapbattle module\r\nintermission_time 15000\r\n\r\n# Toogles wether teamkilling the flag runner in CTF modes should disallow the teamkiller from stealing the flag\r\nctf_teamkill_penalty true\r\n\r\n###############################################################################\r\n# Authkey configuration for Name protection & Admin\r\n###############################################################################\r\n\r\nadmin_domains \"haythserv:admin\" # Domain for admin\r\ninvadmin_domains \"haythserv:admin\" # Same\r\nauto_invadmin_domains \"haythserv_admin\" # Same, if you want to be auto-invadmin at connection\r\n\r\nmaster_domains \"haythserv:master\" # Domain for master\r\ninvmaster_domains \"haythserv:master\" # Same\r\nauto_invmaster_domains \"haythserv:master\" # Same, if you want to be auto-invadmin at connection\r\n\r\n#name_reservation_domain \"127.0.0.1\" # Domain for name protect\r\n#auth_domains \"127.0.0.1\" # Domain for privileges with new authserver\r\n\r\n#module \"auth/name\" # Module for name protect\r\nmodule \"auth/invmaster\" # Module for auto-invmaster\r\nmodule \"auth/invadmin\" # Module for auto-invadmin\r\n#module \"auth/privileges\" # New privileges module to set inv-master/admin with new authserver. Disable auth/invadmin and auth/invmaster before enabling this\r\n\r\n###############################################################################\r\n# Jabber Bot\r\n###############################################################################\r\n\r\n#xmpp_jid \"\"\r\n#xmpp_password \"\"\r\n#xmpp_debug 0\r\n#xmpp_muc_jid \"\"\r\n#xmpp_muc_nick \"HaythServ-Bot\"\r\n#xmpp_muc_password \"\"\r\n#xmpp_bot_command_name \"#\"\r\n\r\n###############################################################################\r\n# Stats\r\n###############################################################################\r\n\r\nstats_use_sqlite 0 # Use a SQLite3 Database: default option, only if you can't connect to a MySQL server, because some functions are missing\r\nstats_use_json 0 # Use a JSON Database: very incomplete, don't use\r\nstats_use_mysql 0 # Use a MySQL Database: Best option if you have a MySQL server, otherwise, choose SQLite3\r\nstats_use_psql 0 # Use a PostGreSQL database, actually not working.\r\nstats_query_backend mysql # Used database : mysql, sqlite3, json, psql\r\n\r\nstats_mysql_hostname \"localhost\" # MySQL server hostname\r\nstats_mysql_port \"3306\" # MySQL server port\r\nstats_mysql_username \"haythserv\" # MySQL database username\r\nstats_mysql_password \"haythserv\" # MySQL database password\r\nstats_mysql_database \"haythserv\" # MySQL database name\r\nstats_mysql_install true # Switch to false after first launch\r\n\r\nstats_psql_hostname \"localhost\" # PostGreSQL server hostname\r\nstats_psql_port \"5432\" # PostGreSQL server port\r\nstats_psql_username \"haythserv\" # PostGreSQL database username\r\nstats_psql_password \"haythserv\" # PostGreSQL database password\r\nstats_psql_database \"haythserv\" # PostGreSQL database name\r\nstats_psql_install true # Switch to false after first launch\r\n\r\nstats_servername \"HaythServ\" # Server name, for displaying in scoreboard\r\nstats_use_auth 1 # Use auth with stats\r\nstats_auth_domain \"haythserv\" # Domain for auth\r\nstats_overwrite_name_with_authname 1 # Replace current name with authkey's name in stats\r\nstats_tell_auth_name 1 # Display authname at intermission and when authkey is validated\r\n\r\n\r\n###############################################################################\r\n# Map rotation\r\n###############################################################################\r\n\r\n# Possible values for map_rotation_type include: standard, random, size\r\nmap_rotation_type \"standard\"\r\n\r\n# The map rotation lists\r\nexec \"conf/new_maps.conf\"\r\nexec \"conf/maps.conf\"\r\n\r\n# The server's preferred game mode\r\ndefault_gamemode \"instagib\"\r\n\r\n# Change back to the default game mode when the server goes empty\r\ndefault_game_on_empty 1\r\n\r\n# For the next map, choose an appropiate sized map from a map rotation, depending on the number of players connected.\r\n# The small map set is used when the player count less than or equal to <small_gamesize>, else the big map set is used.\r\nsmall_single_game 5\r\nsmall_team_game 5\r\n\r\n###############################################################################\r\n# Map vote restrictions\r\n###############################################################################\r\n\r\nallow_mapvote 1\r\n\r\nallowed_gamemodes [\r\n    \"ffa\"\r\n    \"coop edit\"\r\n    \"teamplay\"\r\n    \"instagib\"\r\n    \"instagib team\"\r\n    \"efficiency\"\r\n    \"efficiency team\"\r\n    \"tactics\"\r\n    \"tactics teams\"\r\n    \"capture\"\r\n    \"regen capture\"\r\n    \"ctf\"\r\n    \"insta ctf\"\r\n    \"protect\"\r\n    \"insta protect\"\r\n    \"hold\"\r\n    \"insta hold\"\r\n    \"efficiency ctf\"\r\n    \"efficiency protect\"\r\n    \"efficiency hold\"\r\n    \"insta collect\"\r\n    \"efficiency collect\"\r\n    \"collect\"\r\n]\r\n\r\n# Block votes for unknown maps (known maps are released maps found in the official game distribution)\r\nmapvote_disallow_unknown_map 1\r\n\r\n# Block votes for maps not in the game-mode's map rotation\r\nmapvote_disallow_excluded_map 0\r\n\r\n###############################################################################\r\n# Master restrictions\r\n###############################################################################\r\n\r\nmastermode 0 # Default mastermode\r\ndefault_mastermode 0 # Change default mastermode\r\nallow_setmaster 1 # Allow /setmaster 1 command to be used for gaining master\r\nallow_mastermode_open 1 # Allow master to set open mastermode\r\nallow_mastermode_veto 1 # Allow master to set veto mastermode\r\nallow_mastermode_locked 1 # Allow master to set locked mastermode\r\nallow_mastermode_private 0 # Allow master to set private mastermode\r\nallow_reconnect_with_private_mastermode 1 # Allow a player to reconnect when private mastermode is set\r\nreset_mastermode 1 # Reset mastermode when last master leaves / drops privileges\r\n\r\n###############################################################################\r\n# Web admin configuration\r\n###############################################################################\r\n\r\n# The web admin control panel url is http://localhost:28788/admin\r\n# There is no login required when access is through localhost\r\n\r\n# To create a new web admin user run this shell command: source bin/env.sh; bin/utils/luapp bin/utils/web_admin.lua <username> <password>\r\n# Copy and paste the output here into the web_admins list:\r\nweb_admins [ ]\r\n\r\n###############################################################################\r\n# Player Commands configuration\r\n###############################################################################\r\n\r\nenable_commands [\r\n    cheater\r\n    votekick\r\n    specall\r\n    unspecall\r\n    maxclients\r\n    uptime\r\n    reload\r\n    changetime\r\n    players\r\n    names\r\n    pause\r\n    resume\r\n    motd\r\n    cookie\r\n    givemaster\r\n    mute\r\n    unmute\r\n    me\r\n    ban\r\n    unban\r\n    persist\r\n    versus\r\n    warning\r\n    msg\r\n    stats\r\n    nextmap\r\n    eval\r\n    group\r\n    specmsg\r\n    slay\r\n    recorddemo\r\n    giveadmin\r\n    forcespec\r\n    unforcespec\r\n    setnextmap\r\n    traffic\r\n    banlist\r\n    fairgame\r\n    whoisonline\r\n    admin\r\n    invadmin\r\n    master\r\n    invmaster\r\n    forgive\r\n    mapsucks\r\n    clanwar\r\n    rename\r\n    disconnect\r\n    info\r\n    help\r\n    delgban\r\n    gbans\r\n    spy\r\n    version\r\n    privileges\r\n    announce\r\n    revokepriv\r\n    changepriv\r\n    getip\r\n    cginsta\r\n    sginsta\r\n    rlinsta\r\n    glinsta\r\n    instaammo\r\n    instahp\r\n    defaultcc\r\n    spawnhealth\r\n    spawnarmour\r\n    botname\r\n    instaarmour\r\n    efficammomultipler\r\n    resetinsta\r\n    masterkicktime\r\n    login\r\n    register\r\n    man\r\n    root\r\n# setloginprivs        ### Not working - To be fixed soon\r\n# loginpm ### Not working - To be fixed soon\r\n]\r\n\r\ndisable_commands [\r\n    noties\r\n    suddendeath\r\n    sd\r\n    nosd\r\n]\r\n\r\n###############################################################################\r\n# Modules\r\n###############################################################################\r\n\r\nmodule \"stats\" # Record game statistics to a database (it is needed for the stats and names commands)\r\n\r\nmodule \"display/ownage\" # Display player achievement messages\r\nmodule \"display/awards\" # Show End Stats Game of ended map during the intermission\r\n\r\nmodule \"detect/camping\" # Name and shame players who are found to be camping\r\n#module \"detect/camping_penalty\" # Players who are camping go in specs for 10 seconds (penality)\r\n\r\n#module \"balance/teams/by_adding_bots\" # Use bots to balance teams\r\n#module \"balance/teams/by_moving_players\" # Player moving team balancing\r\n#module \"balance/teams/passive\" # Player moving team when they are death and cry Balance\r\n\r\n#module \"balance/server_size/by_spec_count\" # Increase the server capacity; depends on the spectator count\r\n#module \"balance/server_size/by_mastermode\" # Make server bigger when it goes into locked mode so that many more spectators can connect (default resize is 50 players)\r\n#module \"balance/server_size/by_gamemode\" # Increase/ Decrease server; depends on the current gamemode\r\n\r\n#module \"override/gameduration\" # Change the usual 10 minutes game duration to 15 minutes\r\n#module \"override/default_mastermode\" # Change the default mastermode (to locked by default)\r\n\r\nmodule \"recordgames\" # Auto record demos of every game\r\n\r\nmodule \"limit/inactivity\" # Move inactive (dead or not moving) players to spectators\r\n#module \"limit/spectating\" # Disconnect spectators at \"intermission\", after min. 30 minutes, when server is full and they haven't been active in chat for 5 minutes\r\nmodule \"limit/ping\" # Move lagging players to spectators after 2 warnings\r\n\r\n\r\n#module \"gamemode/no_ties\" # Prevent ties by continouse increasing the maptime by one minute until there is a clear ranking order (it is needed for the noties command)\r\n#module \"gamemode/suddendeath\" # Like no ties, but it stops the game, immediately, when a team scores one more time (it is needed for the suddendeath btw. sd and nosd commands)\r\n\r\n#module \"jabber/lua_jabber_bot\" # A ugly and unstable Jabber Bot\r\n#module \"name_lock\" # Prevent players from renaming\r\nmodule \"mute_spectators\" # Mute all spectators, requiered for #mutespecs and #unmutespecs commands\r\n\r\n#module \"teamkill_protect\" # Disallow teamkills if the teamkiller tk/frags ratio is above 0.25\r\n\r\nmodule \"mapbattle\" # Vote for map at intermission\r\n\r\n###############################################################################\r\n#IRC MODULES\r\n###############################################################################\r\n\r\n#irc_socket_password \"\"\r\n#module \"irc/python_bot\" # Required for the external irc-bot, dont forget to set a connection pass above!\r\n\r\n#After that you need to configure the config.py file. You can find it in the /python_bot folder. Have fun!\r\n\r\n#################################################################################\r\n# Message customization\r\n#################################################################################\r\n# Take the message's var you want customize from script/modules/declare/messages.vars\r\n# Exemple: There's a \"global forgive_actor_forgiven_message\" in messages.vars\r\n# So the line to put here, for exemple, is → forgive_actor_forgiven_message (concat \"You've been forgiven by\" (blue \"%s\"))\r\n```\r\n\r\nLet's start with:\r\n\r\n```lua\r\nservername \"^f3Running ^f5HaythServ\"\r\n```\r\n\r\nwell, that's the server's name. It can be what ever you want.\r\n\r\n```lua\r\n# serverip \"0.0.0.0\"\r\n```\r\n\r\nYou can let this commented if you have only one ip.\r\n\r\n```lua\r\nserverport 28785\r\n```\r\n\r\nThis is the server port it will use, you need to open serverport and serverport+1, both for UDP.\r\n\r\n```lua\r\npublicserver 1\r\n```\r\n\r\nChange this to 0 if you don't want the server to show on server list.\r\n\r\n```lua\r\nmaxclients 128\r\n```\r\n\r\nThis is the number of the maximal clients allowed, max is 128.\r\n\r\n```lua\r\nspecslots 0\r\n```\r\n\r\nThis are specsslot, extra slots for every spectator.\r\n\r\n```lua\r\nmotd (concat (red \"Running\") (magenta \"HaythServ\"))\r\n```\r\n\r\nThis is the \"Message of the Day\", it is sent to players at connect.\r\n\r\n```lua\r\nroot_password \"crackme\"\r\nadmin_password \"wasd\"\r\nmaster_password \"dsaw\"\r\n```\r\n\r\nWell this are the passwords to claim the various privileges.\r\n\r\n```lua\r\ndefault_gamemode \"instagib\"\r\ndefault_game_on_empty 1\r\n``` \r\n\r\nDefault_gamemode is the server's default gamemode - it's the gamemode used at startup, if default_game_on_empty is set to 1, the gamemode will change to the default one when the server gets empty.\r\n\r\n### Advanced configurations\r\n\r\n#### Setting up an insta ctf server\r\n\r\n```lua\r\nallow_mapvote 1\r\nallowed_gamemodes [\r\n    \"ffa\"\r\n    \"coop edit\"\r\n    \"teamplay\"\r\n    \"instagib\"\r\n    \"instagib team\"\r\n    \"efficiency\"\r\n    \"efficiency team\"\r\n    \"tactics\"\r\n    \"tactics teams\"\r\n    \"capture\"\r\n    \"regen capture\"\r\n    \"ctf\"\r\n    \"insta ctf\"\r\n    \"protect\"\r\n    \"insta protect\"\r\n    \"hold\"\r\n    \"insta hold\"\r\n    \"efficiency ctf\"\r\n    \"efficiency protect\"\r\n    \"efficiency hold\"\r\n    \"insta collect\"\r\n    \"efficiency collect\"\r\n    \"collect\"\r\n]\r\n```\r\n\r\nIf we want to allow people to vote for map / mode, then we need to set allow_mapvote to 1, else to 0. Allow_gamemodes is an array of all the allowed gamemodes for non-admins. If we want e.g. to do an insta ctf server, then the allowed_gamemodes array will look like this:\r\n\r\n```lua\r\nallowed_gamemodes [\r\n    \"insta ctf\"\r\n]\r\n```\r\n\r\n#### Enabling / Disabling commands\r\n\r\nIn the ./conf/server.conf file, there is a \"enable_commands\" and a \"disable_commands\" array, this are used to enable / disable commands, if we e.g. want to disable the #register command, or we want to enable #sd and #nosd, they will look something like this:\r\n\r\n```lua\r\nenable_commands [\r\n    [...]\r\n    login\r\n    # Note we removed the register command from here!\r\n    man\r\n    [...]\r\n    # The other commands we want to enable\r\n    sd \r\n    nosd\r\n]\r\n\r\ndisable_commands [\r\n    noties\r\n    suddendeath\r\n    register\r\n]\r\n```\r\n\r\nthen we need to uncomment the suddendeath module\r\n\r\n```lua\r\n#module \"gamemode/no_ties\"\r\nmodule \"gamemode/suddendeath\" # We uncommented it by removing the '#' at the begin of the line.\r\n```\r\n\r\n***\r\n\r\n## Running the server.\r\n\r\nTo start, stop, restart, update the server's configuration files and MUCH more, we just need to use the ./bin/server script, here is it's syntax:\r\n\r\n```bash\r\n$ ./bin/server help\r\nusage: ./bin/server [start] [--no-statuslog]\r\n       ./bin/server [start] luapp luafile\r\n       ./bin/server [start] shell [ruby|perl]\r\n\r\n       ./bin/server stop\r\n\r\n       ./bin/server restart\r\n\r\n       ./bin/server status [output file]\r\n       ./bin/server updateconf\r\n       ./bin/server password 'new password'\r\n```\r\n\r\nPlease note that ./bin/server restart will set the server for a restart at the end of the game.\r\n\r\n***\r\n\r\n## HaythServ's story\r\n\r\n***\r\n\r\nThe first \"private\" release of HaythServ was done at end of year 2012, it was some basically modifics of HopMod. Jed did this work, he did some basically login system, but then I saw SuckerServ, it looked like a much better server mod, but at the moment I know it is not. I started modding it, I added some commands, changed some privileges, added Jed's login, and runned a server. At Jun, 13th 2013 I published it's first release on http://github.com/Gnaoprr/HaythServ.\r\n\r\n***\r\n\r\n# Notes\r\n\r\n1. The extended man system (#man) requires you to use a bigger console size (/consize 15), because most of those manpages have more than the usual 5 console lines.\r\n2. The Unix-like command syntax is not available for all commands.\r\n3. Cheater-detection is a beta, so don't grumble if it doesn't work correctly.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}